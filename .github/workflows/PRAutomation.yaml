name: PR Handler Workflow

on:
  pull_request:
    types: [opened]

jobs:
  handle-pr:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the PR branch
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # Full history for accurate diff

    - name: Fetch PR base and head branches
      run: |
        git fetch origin ${{ github.event.pull_request.base.ref }}
        git fetch origin ${{ github.event.pull_request.head.ref }}

    - name: Save PR Changes to changes.txt
      run: |
        git diff origin/${{ github.event.pull_request.base.ref }}...origin/${{ github.event.pull_request.head.ref }} > changes.txt

    - name: Show contents of changes.txt
      run: cat changes.txt

    - name: Update PR title and body
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PR_NUMBER: ${{ github.event.pull_request.number }}
        NEW_TITLE: "ðŸ”§ Auto-Updated PR Title"
        NEW_BODY: |
          ### ðŸ”„ Auto-Updated PR Description

          This description has been updated by a GitHub Actions workflow.
      run: |
        gh auth setup-git
        gh pr edit "$PR_NUMBER" --title "$NEW_TITLE" --body "$NEW_BODY"
